<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø¨Ø§Ø¯Ù„ - Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø´Ø§Ù…Ù„Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #00cf5d; --bg: #f4f7f6; --dark: #1a1a1a; --white: #ffffff; --red: #ff4d4d; --blue: #3498db; --orange: #e67e22; }
        body { font-family: 'Cairo', sans-serif; background-color: var(--bg); margin: 0; padding: 10px; direction: rtl; }
        .app-container { max-width: 500px; margin: auto; background: var(--white); border-radius: 20px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.08); }
        header { background: var(--dark); color: var(--primary); padding: 20px; text-align: center; font-size: 1.4rem; font-weight: 700; border-bottom: 4px solid var(--primary); }
        .tabs { display: flex; background: #f8f9fa; }
        .tab-btn { flex: 1; padding: 15px; border: none; background: none; font-family: 'Cairo', sans-serif; font-weight: 600; color: #888; cursor: pointer; }
        .tab-btn.active { background: var(--white); border-bottom: 3px solid var(--primary); color: var(--dark); }
        .content { padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 6px; font-size: 0.95rem; font-weight: 600; color: #444; }
        input, select { width: 100%; padding: 12px; border: 1.5px solid #eee; border-radius: 10px; box-sizing: border-box; font-family: 'Cairo', sans-serif; font-size: 1rem; background: #fafafa; }
        
        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .btn-submit { width: 100%; padding: 15px; background: var(--primary); color: #000; border: none; border-radius: 12px; font-weight: 700; font-size: 1.1rem; cursor: pointer; margin-top: 10px; }
        .btn-download-all { width: 100%; padding: 12px; background: #2c3e50; color: #fff; border: none; border-radius: 12px; font-weight: 700; margin-top: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }

        .booking-card { background: #fff; border: 1px solid #f0f0f0; padding: 15px; border-radius: 15px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); position: relative; }
        .badge { padding: 3px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; color: white; float: left; }
        .badge-daily { background: var(--blue); }
        .badge-weekly { background: #9b59b6; }
        .badge-monthly { background: var(--orange); }
        .booking-id-text { color: var(--primary); font-weight: bold; font-size: 0.8rem; display: block; margin-bottom: 5px; }
        
        .countdown-box { margin-top: 10px; padding: 10px; border-radius: 10px; background: #fff9e6; border: 1px solid #ffeeba; color: #856404; font-size: 0.85rem; font-weight: 700; text-align: center; }
        .expired { background: #fff5f5; border-color: #feb2b2; color: #c53030; }

        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px; }
        .btn-action { padding: 8px; border-radius: 8px; border: none; font-family: 'Cairo', sans-serif; font-weight: 600; cursor: pointer; font-size: 0.85rem; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-edit { background: #f1f3f5; }
        .btn-delete { background: #fff1f1; color: var(--red); }
        .btn-csv { background: #e7fcf0; color: #0d6d3d; grid-column: span 2; border: 1px dashed var(--primary); }
        
        .hidden { display: none; }
        .time-info { font-size: 0.8rem; color: #999; margin-top: 5px; display: block; }
    </style>
</head>
<body>

<div class="app-container">
    <header>Ø¨Ø§Ø¯Ù„ Ù…Ù„Ø¹Ø¨ Ø§Ù„ÙƒØ¯ÙˆØ©</header>
    
    <div class="tabs">
        <button class="tab-btn active" id="btn-daily" onclick="showTab('daily')">Ø­Ø¬Ø² ÙŠÙˆÙ…ÙŠ</button>
        <button class="tab-btn" id="btn-sub" onclick="showTab('sub')">Ø­Ø¬Ø² Ø¯ÙˆØ±ÙŠ</button>
    </div>

    <div class="content">
        <div id="booking-form">
            <input type="hidden" id="edit-index" value="-1">
            <div class="form-group"><label>Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ø¬Ø²</label><input type="text" id="cust-name" placeholder="Ù…Ø«Ø§Ù„ : Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ"></div>
            
            <div id="daily-fields">
                <div style="display: flex; gap: 10px;">
                    <div class="form-group" style="flex: 1;"><label>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</label><input type="number" id="players" value="0"></div>
                    <div class="form-group" style="flex: 1;"><label>Ø§Ù„Ø³Ø§Ø¹Ø§Øª</label><input type="number" id="hours" step="0" placeholder="0"></div>
                </div>
            </div>

            <div id="sub-fields" class="hidden">
                <div class="form-group"><label>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label><select id="sub-type"><option value="Ø§Ø³Ø¨ÙˆØ¹ÙŠ">Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option><option value="Ø´Ù‡Ø±ÙŠ">Ø´Ù‡Ø±ÙŠ</option></select></div>
                <div class="form-group"><label>ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label><input type="date" id="sub-start-date"></div>
            </div>

            <div class="form-group">
                <label>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº (Ø±ÙŠØ§Ù„)</label>
                <div style="display:flex; gap:10px;">
                    <input type="number" id="cash" placeholder="ÙƒØ§Ø´">
                    <input type="number" id="card" placeholder="Ø´Ø¨ÙƒØ©">
                </div>
            </div>

            <button class="btn-submit" id="save-btn" onclick="saveBooking()">Ø­ÙØ¸ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†</button>
            
            <button class="btn-download-all" id="download-all-btn" onclick="downloadAllCSV()">
                ğŸ“Š ØªÙ†Ø²ÙŠÙ„ ÙƒØ§ÙØ© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª (CSV)
            </button>
        </div>

        <div class="list-section">
            <h3 style="margin-top:25px; border-bottom: 2px solid #eee; padding-bottom: 10px;">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3>
            <div id="bookings-list"></div>
        </div>
    </div>
</div>

<script>
    let bookings = JSON.parse(localStorage.getItem('paddel_bookings')) || [];
    let currentTab = 'daily';
    document.getElementById('sub-start-date').valueAsDate = new Date();

    function showTab(tab) {
        currentTab = tab;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + tab).classList.add('active');
        document.getElementById('daily-fields').classList.toggle('hidden', tab === 'sub');
        document.getElementById('sub-fields').classList.toggle('hidden', tab === 'daily');
    }

    function saveBooking() {
        const editIndex = document.getElementById('edit-index').value;
        const name = document.getElementById('cust-name').value;
        if(!name) return alert("Ù„Ø·ÙØ§Ù‹ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ø¬Ø²");

        const now = new Date();
        const dateStr = now.toLocaleDateString('en-GB').replace(/\//g, '-');
        const timeStr = now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });

        let bookingId = (editIndex == "-1") ? "PDL-" + Math.floor(1000 + Math.random() * 9000) : bookings[editIndex].id;

        const booking = {
            id: bookingId,
            name: name,
            type: currentTab === 'daily' ? 'ÙŠÙˆÙ…ÙŠ' : document.getElementById('sub-type').value,
            cash: document.getElementById('cash').value || 0,
            card: document.getElementById('card').value || 0,
            saveDate: dateStr,
            saveTime: timeStr,
            startDate: currentTab === 'sub' ? new Date(document.getElementById('sub-start-date').value).getTime() : now.getTime(),
            detail: currentTab === 'daily' ? document.getElementById('hours').value + " Ø³Ø§Ø¹Ø©" : "Ø§Ø´ØªØ±Ø§Ùƒ Ø«Ø§Ø¨Øª"
        };

        if (editIndex == "-1") { bookings.unshift(booking); } 
        else { bookings[editIndex] = booking; document.getElementById('edit-index').value = "-1"; }

        localStorage.setItem('paddel_bookings', JSON.stringify(bookings));
        resetForm();
        renderBookings();
    }

    // ÙˆØ¸ÙŠÙØ© ØªÙ†Ø²ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ÙÙŠ Ù…Ù„Ù ÙˆØ§Ø­Ø¯
    function downloadAllCSV() {
        if (bookings.length === 0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ù„ØªÙ†Ø²ÙŠÙ„Ù‡Ø§!");

        let csvContent = "\uFEFFØ±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²,Ø§Ù„Ø§Ø³Ù…,Ø§Ù„Ù†ÙˆØ¹,Ø§Ù„ØªÙØ§ØµÙŠÙ„,ÙƒØ§Ø´,Ø´Ø¨ÙƒØ©,Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„ÙˆÙ‚Øª\n";
        
        bookings.forEach(b => {
            csvContent += `${b.id},${b.name},${b.type},${b.detail},${b.cash},${b.card},${b.saveDate},${b.saveTime}\n`;
        });

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        const dateNow = new Date().toLocaleDateString('en-GB').replace(/\//g, '-');
        
        link.setAttribute("href", url);
        link.setAttribute("download", `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª_Ø§Ù„Ø´Ø§Ù…Ù„_${dateNow}.csv`);
        link.click();
    }

    function getRemainingTime(startDate, type) {
        if (type === 'ÙŠÙˆÙ…ÙŠ') return null;
        const now = new Date().getTime();
        const duration = type === 'Ø§Ø³Ø¨ÙˆØ¹ÙŠ' ? 7 * 24 * 60 * 60 * 1000 : 30 * 24 * 60 * 60 * 1000;
        const expiryDate = startDate + duration;
        const diff = expiryDate - now;
        if (diff <= 0) return { text: "Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ âš ï¸", class: "expired" };
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        return { text: `Ù…ØªØ¨Ù‚ÙŠ: ${days} ÙŠÙˆÙ… Ùˆ ${hours} Ø³Ø§Ø¹Ø©`, class: "" };
    }

    function renderBookings() {
        const list = document.getElementById('bookings-list');
        list.innerHTML = '';
        bookings.forEach((b, index) => {
            const badgeClass = b.type === 'ÙŠÙˆÙ…ÙŠ' ? 'badge-daily' : (b.type === 'Ø§Ø³Ø¨ÙˆØ¹ÙŠ' ? 'badge-weekly' : 'badge-monthly');
            const remaining = getRemainingTime(b.startDate, b.type);

            list.innerHTML += `
                <div class="booking-card">
                    <span class="badge ${badgeClass}">${b.type}</span>
                    <span class="booking-id-text">${b.id}</span>
                    <h4>${b.name}</h4>
                    <p style="margin:5px 0; font-size:0.9rem;">ğŸ•’ ${b.detail}</p>
                    <p style="margin:2px 0; font-size:0.9rem;">ğŸ’° ÙƒØ§Ø´: ${b.cash} | Ø´Ø¨ÙƒØ©: ${b.card}</p>
                    <span class="time-info">Ø³Ø¬Ù„ ÙÙŠ: ${b.saveDate} Ø§Ù„Ø³Ø§Ø¹Ø© ${b.saveTime}</span>
                    ${remaining ? `<div class="countdown-box ${remaining.class}">${remaining.text}</div>` : ''}
                    <div class="actions">
                        <button class="btn-action btn-edit" onclick="editBooking(${index})">ğŸ“ ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn-action btn-delete" onclick="deleteBooking(${index})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                        <button class="btn-action btn-csv" onclick="downloadCSV(${index})">ğŸ“¥ ÙØ§ØªÙˆØ±Ø© ÙØ±Ø¯ÙŠØ©</button>
                    </div>
                </div>
            `;
        });
    }

    function downloadCSV(index) {
        const b = bookings[index];
        let csvContent = "\uFEFFØ±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²,Ø§Ù„Ø§Ø³Ù…,Ø§Ù„Ù†ÙˆØ¹,Ø§Ù„ØªÙØ§ØµÙŠÙ„,ÙƒØ§Ø´,Ø´Ø¨ÙƒØ©,Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„ÙˆÙ‚Øª\n";
        csvContent += `${b.id},${b.name},${b.type},${b.detail},${b.cash},${b.card},${b.saveDate},${b.saveTime}\n`;
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.setAttribute("href", url);
        link.setAttribute("download", `${b.id}_${b.name}.csv`);
        link.click();
    }

    function deleteBooking(index) {
        if(confirm("Ø­Ø°Ù Ø§Ù„Ø­Ø¬Ø²ØŸ")) {
            bookings.splice(index, 1);
            localStorage.setItem('paddel_bookings', JSON.stringify(bookings));
            renderBookings();
        }
    }

    function editBooking(index) {
        const b = bookings[index];
        document.getElementById('cust-name').value = b.name;
        document.getElementById('cash').value = b.cash;
        document.getElementById('card').value = b.card;
        document.getElementById('edit-index').value = index;
        if(b.type !== 'ÙŠÙˆÙ…ÙŠ') showTab('sub'); else showTab('daily');
        document.getElementById('save-btn').innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¬Ø²";
        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function resetForm() {
        document.getElementById('cust-name').value = '';
        document.getElementById('cash').value = '';
        document.getElementById('card').value = '';
        document.getElementById('hours').value = '';
        document.getElementById('save-btn').innerText = "Ø­ÙØ¸ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†";
    }

    renderBookings();
</script>

</body>
</html>
